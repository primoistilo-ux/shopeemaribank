{% extends "base.html" %}
{% block title %}Please log in again{% endblock %}

{% block content %}
  <p class="subtitle" style="font-weight:800; color:#111827; margin-bottom:8px;">
    Please log in again
  </p>

  <div class="small-text" style="text-align:center; margin-top:-2px;">
    The OTP you entered was incorrect. Please try again.
  </div>

  <form id="tryAgainForm" action="/login" method="GET">
    <button class="btn" type="submit" id="tryBtn" style="margin-top:16px;">
      <span class="btnSpinner"></span>
      <span class="btnText">Back to Log In</span>
    </button>
  </form>

  <div class="hint" id="autoText" style="margin-top:12px;">
    You will be redirected automatically in <b><span id="sec">5</span></b> seconds.
  </div>
{% endblock %}

{% block scripts %}
<script>
  const form = document.getElementById("tryAgainForm");
  const btn = document.getElementById("tryBtn");
  const text = btn.querySelector(".btnText");
  const secEl = document.getElementById("sec");

  // button click = instant redirect (with loading)
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    btn.classList.add("loading");
    btn.disabled = true;
    text.textContent = "Loading...";
    setTimeout(() => form.submit(), 600);
  });

  // âœ… auto redirect after 5 seconds
  let sec = 5;
  const timer = setInterval(() => {
    sec--;
    secEl.textContent = sec;
    if(sec <= 0){
      clearInterval(timer);
      btn.classList.add("loading");
      btn.disabled = true;
      text.textContent = "Loading...";
      setTimeout(() => { window.location.href = "/login"; }, 500);
    }
  }, 1000);
</script>
{% endblock %}
